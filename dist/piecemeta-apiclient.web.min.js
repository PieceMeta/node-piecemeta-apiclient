/*! piecemeta-apiclient browser version - v1.0.0 - 2014-12-30 */!function(){function a(b,c){for(var d,e,f=[],g=b.split("/"),h=0;null!=(e=g[h++]);)".."==e?f.pop():"."!=e&&f.push(e);if(f=f.join("/"),h=a,e=h.m[c||0],d=e[f+".js"]||e[f+"/index.js"]||e[f],g='Cannot require("'+f+'")',!d)throw Error(g);if((e=d.c)&&(d=h.m[c=e][b=d.m]),!d)throw Error(g);return d.exports||d(d,d.exports={},function(a){return h("."!=a.charAt(0)?a:b+"/../"+a,c)}),d.exports}a.m=[],a.m[0]={"src/apiclient.js":function(a,b,c){!function(){"use strict";var b={},d={},e={};a.exports.client=function(a,f,g){var h=c("./util/auth-header");return e=a,d=f,b=g,{resource:function(a){return{action:function(c,f,g,i){var j="/"+a;null===f&&(f=void 0),"string"==typeof f?(j+="/"+f,f=null):"object"==typeof f&&"string"==typeof f.uuid&&(j+="/"+f.uuid,delete f.uuid),e.request({url:b.host+j,auth:h.getTokenHeader(b.access_token),method:c,contentType:b.contentType,data:f?d.unparse(f,b.contentType):void 0},function(a,c){if("function"==typeof g){if(a)return g(a,null);d.parse(c,b.contentType,function(a,b){g(a,b)})}},function(a,b){"function"==typeof i&&i(a,b)})}}},getToken:function(a,c){e.request({url:b.host+"/users/me/access_tokens",method:"post",contentType:b.contentType,data:d.unparse(a,b.contentType)},function(a,e){if("function"==typeof c){if(a)return c(a,null);d.parse(e,b.contentType,function(a,d){!a&&d&&(b.access_token=d),c(a,d)})}})},getCredentials:function(a){e.request({url:b.host+"/users/me/api_keys",method:"get",contentType:b.contentType,auth:h.getTokenHeader(b.access_token)},function(c,e){if("function"==typeof a){if(c)return a(c,null);d.parse(e,b.contentType,function(c,d){b.api_key||(b.api_key={}),b.api_key.key=d[0].key,b.api_key.secret=d[0].secret,a(c,d[0])})}})},setCredentials:function(a,c){b.api_key.key=a,b.api_key.secret=c},authenticate:function(a){b.access_token?a(null,b.access_token.token):e.request({url:b.host+"/users/me/access_tokens",method:"post",contentType:b.contentType,data:d.unparse(b.api_key,b.contentType)},function(c,e){if("function"==typeof a){if(c)return a(c,null);d.parse(e,b.contentType,function(c,d){!c&&d&&(b.access_token=d),a(c,d)})}})}}}}()},"src/http/xmlhttp.js":function(a){!function(){"use strict";a.exports.request=function(a,b,c){if("undefined"==typeof XMLHttpRequest)return void("function"==typeof b&&b(new Error("XMLHttpRequest not available"),null));var d=new XMLHttpRequest;d.open(a.method,a.url,!0),d.setRequestHeader("Content-Type",a.contentType),a.auth&&d.setRequestHeader("Authorization",a.auth),d.onreadystatechange=function(){4===d.readyState&&(200===d.status||201===d.status?b(null,d.responseText):b(new Error("Server responded with status: "+d.status),d.responseText))},d.onprogress=function(a){a.lengthComputable&&"function"==typeof c&&c(a.loaded/a.total,a.total)},a.data?d.send(a.data):d.send()}}()},"src/util/auth-header.js":function(a){!function(){"use strict";a.exports.getTokenHeader=function(a){return a&&"object"==typeof a&&"string"==typeof a.token?"bearer "+a.token:null},a.exports.getBasicHeader=function(a,b){return"string"==typeof a&&"string"==typeof b?"Basic "+atob(a+":"+b):null}}()},"src/util/data-parser.js":function(a){!function(){"use strict";a.exports.parse=function(a,b,c){var d=null,e=null;try{d=JSON.parse(a)}catch(f){e=f}c(e,d)},a.exports.unparse=function(a){return JSON.stringify(a)}}()},"src/web-piecemeta-apiclient.js":function(a,b,c){!function(){"use strict";a.exports=function(a){var b=c("./http/xmlhttp"),d=c("./apiclient"),e=c("./util/data-parser");return d.client(b,e,a)}}()}},PMApi=a("src/web-piecemeta-apiclient.js")}();